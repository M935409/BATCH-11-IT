<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IT BATCH 11 | #MTR#</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap');
        
        :root {
            --primary: #22d3ee;
            --primary-dark: #0891b2;
            --bg-dark: #020617;
            --glass: rgba(15, 23, 42, 0.75);
            --card-border: rgba(255, 255, 255, 0.08);
        }

        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-dark) transparent;
        }

        body { 
            font-family: 'Cairo', sans-serif; 
            background: radial-gradient(circle at top right, #0f172a, #020617); 
            color: #f8fafc; 
            min-height: 100vh; 
            overflow-x: hidden;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .emoji {
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
            font-style: normal;
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙŠØ­Ø© - ØµÙˆØ±ØªÙŠÙ† ÙÙŠ Ø§Ù„ØµÙ Ù„Ù„Ø¬ÙˆØ§Ù„ */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            padding: 8px;
        }

        @media (min-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                padding: 20px;
            }
        }

        @media (min-width: 1280px) {
            .gallery-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
/* ØªØ­Ø³ÙŠÙ† Lightbox */

#lightbox {
    animation: fadeIn 0.3s ease forwards;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

#lightbox img {
    transition: transform 0.4s ease;
}

#lightbox img:hover {
    transform: scale(1.03);
}

#lightbox button {
    backdrop-filter: blur(10px);
}
        /* Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø²Ø¬Ø§Ø¬ */
        .glass-panel { 
            background: var(--glass); 
            backdrop-filter: blur(25px); 
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--card-border); 
        }

        .glass-card { 
            background: rgba(255, 255, 255, 0.02); 
            backdrop-filter: blur(10px); 
            border: 1px solid var(--card-border); 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            border-radius: 1.25rem;
            position: relative;
        }

        .glass-card:active { transform: scale(0.98); }

        /* Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© (Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©) */
        .full-view {
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            z-index: 9000;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        /* ØªØ®ØµÙŠØµ Ø²Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ */
        .react-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.03);
        }

        .react-btn.active[data-type="like"] { color: #3b82f6; background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3); }
        .react-btn.active[data-type="heart"] { color: #ef4444; background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); }
        .react-btn.active[data-type="haha"] { color: #f59e0b; background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.3); }

        /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        .notification-dot {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            border: 2px solid var(--bg-dark);
        }

        /* Ø§Ù„Ù„ÙˆØ¯Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        /* Splash Screen Transitions */
#splash-screen {
    transition: opacity 0.5s ease, visibility 0.5s ease;
}

#splash-screen.hidden {
    opacity: 0;
    visibility: hidden;
}

/* Animations */
@keyframes slideDown {
    0% { opacity: 0; transform: translateY(-30px); }
    100% { opacity: 1; transform: translateY(0); }
}

@keyframes slideUp {
    0% { opacity: 0; transform: translateY(30px); }
    100% { opacity: 1; transform: translateY(0); }
}

.animate-slide-down {
    animation: slideDown 1s ease forwards;
}

.animate-slide-up {
    animation: slideUp 1s ease 0.5s forwards;
}

/* Loading Dots Animation */
@keyframes bounce-dot {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

.dot {
    animation: bounce-dot 1.2s infinite ease-in-out;
}

.dot.delay-0 { animation-delay: 0s; }
.dot.delay-150 { animation-delay: 0.15s; }
.dot.delay-300 { animation-delay: 0.3s; }

/* Lucide icons bounce */
.animate-bounce {
    animation: bounce-dot 1s infinite alternate;
}
    </style>
<body class="selection:bg-cyan-500/30">
<!-- Splash Screen -->
<div id="splash-screen" class="fixed inset-0 z-[30000] flex flex-col items-center justify-center bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white">
    <div class="flex flex-col items-center gap-6">
        <!-- Ø´Ø¹Ø§Ø± Ù†Øµ Batch 11 IT -->
        <h1 class="text-5xl md:text-7xl font-extrabold tracking-widest uppercase text-gray-100 drop-shadow-lg opacity-0 animate-slide-down">
            Batch <span class="text-cyan-400">11</span> IT
        </h1>

        <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…ØªØ¯Ø±Ø¬Ø© -->
        <div class="flex gap-8 mt-4 opacity-0 animate-slide-up">
            <i data-lucide="activity" class="w-6 h-6 text-cyan-400 animate-bounce"></i>
            <i data-lucide="cpu" class="w-6 h-6 text-blue-400 animate-bounce delay-200"></i>
            <i data-lucide="code" class="w-6 h-6 text-indigo-400 animate-bounce delay-400"></i>
        </div>

        <!-- Loading Dots -->
        <div class="flex gap-2 mt-6">
            <div class="dot bg-cyan-400 w-3 h-3 rounded-full animate-bounce delay-0"></div>
            <div class="dot bg-cyan-400 w-3 h-3 rounded-full animate-bounce delay-150"></div>
            <div class="dot bg-cyan-400 w-3 h-3 rounded-full animate-bounce delay-300"></div>
        </div>
    </div>
</div>
    <div id="toast-container" class="fixed top-20 left-1/2 -translate-x-1/2 z-[20000] w-[90%] max-w-sm pointer-events-none"></div>

    <nav class="glass-panel sticky top-0 z-[5000] px-4 py-3 border-b border-white/5">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">
                <div class="flex flex-col items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-cyan-500/20 transition-all hover:scale-110 active:scale-95">
                        <i data-lucide="activity" class="text-white w-6 h-6 animate-pulse"></i>
                    </div>
                    <span class="text-[9px] font-black text-cyan-400 mt-1 uppercase tracking-tighter">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                </div>

                <div class="flex flex-col justify-center">
                    <h1 class="font-black text-lg tracking-tight leading-none text-white">IT <span class="text-cyan-400">BATCH 11</span></h1>
                    <p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest mt-1">BY: MTR</p>
                </div>
            </div>

            <div class="flex items-center gap-2">
                <button onclick="openMtrCenter()" class="group relative p-2.5 rounded-xl bg-white/5 hover:bg-cyan-500/10 transition-all border border-white/5 hover:border-cyan-500/30">
                    <i data-lucide="settings-2" class="w-5 h-5 text-gray-400 group-hover:text-cyan-400 group-hover:rotate-180 transition-transform duration-700"></i>
                    <span class="absolute -top-0.5 -right-0.5 w-2 h-2 bg-cyan-500 rounded-full animate-pulse shadow-[0_0_8px_#22d3ee]"></span>
                </button>

                <button onclick="openNotifications()" class="relative p-2.5 rounded-xl bg-white/5 hover:bg-white/10 transition-all text-gray-400">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <div id="notif-dot" class="hidden notification-dot"></div>
                </button>

                <div id="user-area" class="flex items-center gap-3">
                    <div id="logged-in-user" class="hidden flex items-center gap-2 bg-white/5 p-1 rounded-full pl-3 pr-1 border border-white/5">
                        <div id="user-avatar" class="w-8 h-8 rounded-full bg-cyan-500 flex items-center justify-center text-xs font-black text-white"></div>
                        <span id="welcome-name" class="text-xs font-bold hidden md:inline text-white"></span>
                        <button onclick="confirmAction('Ø®Ø±ÙˆØ¬', 'Ù‡Ù„ ØªÙˆØ¯ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ', 'logout')" class="p-1.5 text-red-400"><i data-lucide="log-out" class="w-4 h-4"></i></button>
                    </div>
                    <div id="auth-btns" class="flex gap-1">
                        <button onclick="showSection('login')" class="text-xs font-bold px-3 py-2 text-white">Ø¯Ø®ÙˆÙ„</button>
                        <button onclick="showSection('register')" class="bg-white text-black text-xs font-black px-4 py-2 rounded-lg transition-all hover:bg-cyan-400">Ø§Ù†Ø¶Ù…Ø§Ù…</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <header id="hero-section" class="max-w-7xl mx-auto px-4 pt-8 pb-4">
        <div class="bg-gradient-to-b from-cyan-500/10 to-transparent p-10 rounded-[2.5rem] border border-white/5 text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-5 pointer-events-none"></div>
            <div class="flex justify-center mb-4">
                <div class="px-4 py-1 rounded-full border border-cyan-500/20 bg-cyan-500/5 text-cyan-400 text-xs font-bold">
    Ø¬Ø§Ù…Ø¹Ø© ÙˆØ¯ Ù…Ø¯Ù†ÙŠ Ù„Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§
</div>
            </div>
            <h2 id="hero-title" class="text-3xl md:text-5xl font-black text-white mb-4 tracking-tight">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">Ù…Ù†ØµØªÙ†Ø§ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</span></h2>
            <p class="text-gray-400 text-sm md:text-lg max-w-xl mx-auto leading-relaxed">Ø£Ø±Ø´ÙŠÙ Ø°ÙƒØ±ÙŠØ§Øª Batch 11 IT. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ø¢Ù† Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù„Ø­Ø¸Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªÙÙ†Ø³Ù‰.</p>
            <div class="w-full flex justify-center mt-10">
                <button onclick="handleUploadClick()" class="group flex items-center gap-3 px-8 py-4 bg-cyan-500 hover:bg-white text-black font-black rounded-2xl shadow-2xl shadow-cyan-500/20 transition-all hover:-translate-y-1 active:scale-95">
                    <i data-lucide="plus-circle" class="w-5 h-5 group-hover:rotate-90 transition-transform"></i> Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>
        </div>
    </header>

    <div id="mtr-center-modal" class="fixed inset-0 z-[10000] hidden items-center justify-center p-4 bg-black/80 backdrop-blur-2xl">
        <div class="glass-panel w-full max-w-md max-h-[90vh] flex flex-col rounded-[2.5rem] border border-white/10 overflow-hidden shadow-2xl animate-in zoom-in duration-300">
            
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/5 shrink-0">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-cyan-500/10 flex items-center justify-center border border-cyan-500/20">
                        <i data-lucide="cpu" class="text-cyan-400 w-5 h-5 animate-spin-slow"></i>
                    </div>
                    <div>
                        <h3 class="font-black text-white text-[11px] uppercase tracking-widest leading-none mb-1">System Control</h3>
                        <p class="text-[8px] text-cyan-500/50 font-mono tracking-tighter uppercase">Root // MTR-Engine-v4.0.0</p>
                    </div>
                </div>
                <button onclick="toggleModal('mtr-center-modal', false)" class="p-2 hover:bg-white/10 rounded-full text-gray-500 hover:text-white transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="p-4 overflow-y-auto flex-grow custom-scrollbar">
                
                <div id="mtr-main-menu" class="space-y-3">
                    <button onclick="switchMtrView('mtr-privacy')" class="w-full flex items-center justify-between p-5 bg-white/5 border border-white/5 rounded-3xl hover:bg-cyan-500/10 hover:border-cyan-500/30 transition-all group">
                        <i data-lucide="chevron-left" class="w-4 h-4 text-gray-700 group-hover:text-cyan-400"></i>
                        <div class="flex items-center gap-4 text-right">
                            <div>
                                <h4 class="text-white font-bold text-sm">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h4>
                                <p class="text-[10px] text-gray-500">Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª</p>
                            </div>
                            <div class="p-3 bg-cyan-500/10 rounded-2xl text-cyan-400 group-hover:scale-110 transition-transform">
                                <i data-lucide="shield-check" class="w-5 h-5"></i>
                            </div>
                        </div>
                    </button>
                    <button onclick="switchMtrView('mtr-dev')" class="w-full flex items-center justify-between p-5 bg-white/5 border border-white/5 rounded-3xl hover:bg-blue-500/10 hover:border-blue-500/30 transition-all group">
                        <i data-lucide="chevron-left" class="w-4 h-4 text-gray-700 group-hover:text-blue-400"></i>
                        <div class="flex items-center gap-4 text-right">
                            <div>
                                <h4 class="text-white font-bold text-sm">Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ø¨Ø±Ù…Ø¬Ø©</h4>
                                <p class="text-[10px] text-gray-500">ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±</p>
                            </div>
                            <div class="p-3 bg-blue-500/10 rounded-2xl text-blue-400 group-hover:scale-110 transition-transform">
                                <i data-lucide="code-2" class="w-5 h-5"></i>
                            </div>
                        </div>
                    </button>
                    <button onclick="switchMtrView('mtr-password')" class="w-full flex items-center justify-between p-5 bg-white/5 border border-white/5 rounded-3xl hover:bg-orange-500/10 hover:border-orange-500/30 transition-all group">
    <i data-lucide="chevron-left" class="w-4 h-4 text-gray-700 group-hover:text-orange-400"></i>
    <div class="flex items-center gap-4 text-right">
        <div>
            <h4 class="text-white font-bold text-sm">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h4>
            <p class="text-[10px] text-gray-500">ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</p>
        </div>
        <div class="p-3 bg-orange-500/10 rounded-2xl text-orange-400 group-hover:scale-110 transition-transform">
            <i data-lucide="key-round" class="w-5 h-5"></i>
        </div>
    </div>
</button>
                </div>
<div id="mtr-password" class="hidden space-y-6 text-right pb-4" dir="rtl">
    <button onclick="switchMtrView('mtr-main-menu')" class="flex items-center gap-2 text-orange-400 text-[10px] font-black uppercase hover:gap-3 transition-all mb-4">
        <i data-lucide="arrow-right" class="w-4 h-4"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø±ÙƒØ²
    </button>
    <div class="border-r-4 border-orange-500 pr-4 mb-6">
        <h4 class="text-white font-black text-xl tracking-tighter">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù…Ø§Ù†</h4>
        <p class="text-[9px] text-orange-500/70 font-mono uppercase mt-1">Update Security Credentials</p>
    </div>
    
    <div class="space-y-4">
        <div class="space-y-2 relative">
            <label class="text-[10px] font-bold text-gray-500 px-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
            <input type="password" id="new-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                   class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 pl-10 text-white text-sm focus:border-orange-500/50 outline-none transition-all">
            <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¹ÙŠÙ† ØªØªØ­ÙƒÙ… ÙÙŠ ÙƒÙ„Ø§ Ø§Ù„Ø­Ù‚Ù„ÙŠÙ† -->
            <i data-lucide="eye" class="absolute top-1/2 left-3 -translate-y-1/2 cursor-pointer text-gray-400"
               onclick="toggleBothPasswords()"></i>
        </div>

        <div class="space-y-2">
            <label class="text-[10px] font-bold text-gray-500 px-2">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="confirm-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                   class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-white text-sm focus:border-orange-500/50 outline-none transition-all">
        </div>

        <button onclick="handlePasswordUpdate()" id="update-pass-btn" 
                class="w-full py-4 bg-orange-500 hover:bg-orange-600 text-black font-black 
                       rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-2">
            ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        </button>
    </div>
</div>
                <div id="mtr-privacy" class="hidden space-y-6 text-right pb-4" dir="rtl">
                    <button onclick="switchMtrView('mtr-main-menu')" class="flex items-center gap-2 text-cyan-400 text-[10px] font-black uppercase hover:gap-3 transition-all mb-4">
                        <i data-lucide="arrow-right" class="w-4 h-4"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø±ÙƒØ²
                    </button>
                    <div class="border-r-4 border-cyan-500 pr-4">
                        <h4 class="text-white font-black text-xl tracking-tighter">Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯</h4>
                        <p class="text-[9px] text-cyan-500/70 font-mono uppercase mt-1">Classification: Top Secret // IT-B11</p>
                    </div>
                    <div class="space-y-4">
                        <p class="text-gray-300 text-xs leading-relaxed font-medium">
                            Ø¨Ù…Ø¬Ø±Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¥Ù„Ù‰ Ù…Ù†ØµØ© <span class="text-cyan-400 font-bold">Batch 11 IT Gallery</span>ØŒ ÙØ£Ù†Øª Ø¶Ù…Ù† Ø¨ÙŠØ¦Ø© ØªÙ‚Ù†ÙŠØ© Ù…ØºÙ„Ù‚Ø© ØªØ®Ø¶Ø¹ Ù„Ø±Ù‚Ø§Ø¨Ø© Ø¨Ø±Ù…Ø¬ÙŠØ© Ù…ØªØ·ÙˆØ±Ø©. ØªÙ… ØªØµÙ…ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ÙˆØ§Ø³Ø·Ø© <span class="text-white font-bold">MTR-Engine</span>.
                        </p>
                        <div class="bg-red-500/5 border border-red-500/20 p-4 rounded-2xl space-y-3">
                            <div class="flex items-center gap-2 text-red-500">
                                <i data-lucide="shield-alert" class="w-4 h-4"></i>
                                <span class="text-[10px] font-black uppercase tracking-widest">ØªØ­Ø°ÙŠØ±Ø§Øª Ø£Ù…Ù†ÙŠØ©</span>
                            </div>
                            <ul class="text-[10px] text-gray-400 space-y-2">
                                <li class="flex items-start gap-2 italic">â–  ÙŠÙÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Data Scraping) Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.</li>
                                <li class="flex items-start gap-2 italic">â–  Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ø¨Ø± IP Tracking.</li>
                                <li class="flex items-start gap-2 italic">â–  Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø®ØªØ±Ø§Ù‚ Ø³ØªØ¤Ø¯ÙŠ Ù„Ø­Ø¸Ø± Ø§Ù„Ù€ Hardware ID.</li>
                            </ul>
                        </div>
                        <div class="bg-cyan-500/5 border border-cyan-500/10 p-4 rounded-2xl">
                            <div class="flex items-center gap-2 text-cyan-400 mb-2 font-black text-[10px] uppercase">Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ´ÙÙŠØ±</div>
                            <p class="text-[10px] text-gray-400 leading-relaxed">ØªØ®Ø²ÙŠÙ† Ù…Ø´ÙØ± Ø¹Ø¨Ø± Supabase Cloud Ø¨ØªØ´ÙÙŠØ± AES-256 Ù„Ø¶Ù…Ø§Ù† Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>
                        </div>
                    </div>
                </div>

                <div id="mtr-dev" class="hidden space-y-8 text-center pb-4">
                    <button onclick="switchMtrView('mtr-main-menu')" class="flex items-center gap-2 text-blue-400 text-[10px] font-black uppercase hover:gap-3 transition-all mx-auto" dir="rtl">
                        <i data-lucide="arrow-right" class="w-4 h-4"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø¯ÙŠØ±
                    </button>
                    <div class="w-20 h-20 mx-auto bg-gradient-to-tr from-cyan-500 to-blue-600 rounded-[2rem] flex items-center justify-center shadow-2xl mb-4 relative transition-transform hover:scale-105">
                        <i data-lucide="terminal" class="text-white w-10 h-10"></i>
                    </div>
                    <h4 class="text-white font-black text-2xl tracking-[0.1em]">MUHAB TARIQ</h4>
                    <p class="text-[9px] text-gray-500 font-bold uppercase tracking-[0.5em] mt-2">Full-Stack Architect</p>
                    <div class="grid grid-cols-3 gap-3 px-2">
                        <a href="https://www.instagram.com/muhab.tarig?igsh=MW00YnU3cnF5YzFhcw==" target="_blank" class="flex flex-col items-center gap-2 p-4 bg-white/[0.03] border border-white/5 rounded-3xl hover:bg-white/10 transition-all group">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg" class="w-6 h-6 group-hover:scale-110 transition-transform" alt="Instagram">
                            <span class="text-[7px] font-bold text-white uppercase">Insta</span>
                        </a>
                        <a href="https://wa.me/249902520425" target="_blank" class="flex flex-col items-center gap-2 p-4 bg-white/[0.03] border border-white/5 rounded-3xl hover:bg-white/10 transition-all group">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="w-6 h-6 group-hover:scale-110 transition-transform" alt="WhatsApp">
                            <span class="text-[7px] font-bold text-white uppercase">WhatsApp</span>
                        </a>
                        <a href="https://www.facebook.com/share/1B2bc5nw6a/" target="_blank" class="flex flex-col items-center gap-2 p-4 bg-white/[0.03] border border-white/5 rounded-3xl hover:bg-white/10 transition-all group">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/2021_Facebook_icon.svg" class="w-6 h-6 group-hover:scale-110 transition-transform" alt="Facebook">
                            <span class="text-[7px] font-bold text-white uppercase">Facebook</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="p-4 border-t border-white/5 bg-black/20 shrink-0">
                <div class="flex flex-col items-center gap-2">
                    <div class="flex items-center justify-center gap-4 text-[7px] font-mono text-gray-600 uppercase tracking-widest">
                        <span>Binary Secure: 1</span>
                        <div class="w-1 h-1 bg-cyan-500 rounded-full"></div>
                        <span>Auth State: Verified</span>
                    </div>
                    <div class="mt-1 px-3 py-1 bg-cyan-500/5 border border-cyan-500/20 rounded-full">
                        <span class="text-[9px] font-black text-cyan-400 font-mono tracking-widest uppercase">Ø±Ù‚Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« <span class="text-white ml-1">v4.0.0</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto">
    <script>
        // ÙØªØ­ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…
        function openMtrCenter() {
            switchMtrView('mtr-main-menu');
            toggleModal('mtr-center-modal', true);
        }

       // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
function switchMtrView(viewId) {
    const views = ['mtr-main-menu', 'mtr-privacy', 'mtr-dev', 'mtr-password']; // <-- Ù‡Ù†Ø§ Ø£Ø¶ÙÙ†Ø§ mtr-password
    views.forEach(v => {
        const el = document.getElementById(v);
        if (el) {
            el.classList.add('hidden');
            el.classList.remove('animate-in', 'slide-in-from-bottom-5');
        }
    });
    const target = document.getElementById(viewId);
    if (target) {
        target.classList.remove('hidden');
        target.classList.add('animate-in', 'slide-in-from-bottom-5', 'duration-500');
    }
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙŠ Ø­Ø§Ù„ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯
    if (window.lucide) lucide.createIcons();
}

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        function toggleModal(id, show) {
            const m = document.getElementById(id);
            if (!m) return;
            if (show) {
                m.classList.remove('hidden');
                m.classList.add('flex');
            } else {
                m.classList.add('hidden');
                m.classList.remove('flex');
            }
        }
    </script>
        <!-- Main Feed -->
    <section id="home" class="tab-content active p-2">
        <div id="gallery" class="gallery-grid grid grid-cols-2 gap-2">
            <div class="glass-card aspect-square shimmer bg-white/5 rounded-2xl"></div>
            <div class="glass-card aspect-square shimmer bg-white/5 rounded-2xl"></div>
            <div class="glass-card aspect-square shimmer bg-white/5 rounded-2xl"></div>
            <div class="glass-card aspect-square shimmer bg-white/5 rounded-2xl"></div>
        </div>
    </section>

    <!-- Login Section -->
    <section id="login" class="tab-content hidden fixed inset-0 z-[10000] bg-slate-950 p-6 flex items-center justify-center">
        <div class="w-full max-w-sm space-y-6">
            <button onclick="showSection('home')" class="text-gray-500 flex items-center gap-2">
                <i data-lucide="arrow-right"></i> Ø±Ø¬ÙˆØ¹
            </button>
            <div class="text-center">
                <h2 class="text-3xl font-black">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <p class="text-gray-500 mt-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ÙŠØ§ Ø²Ù…ÙŠÙ„ÙŠ</p>
            </div>
            <form id="login-form" class="space-y-4" onsubmit="handleLogin(event)">
                <div>
                    <input type="email" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 outline-none focus:border-cyan-500 transition-all">
                    <p id="login-email-feedback" class="text-red-500 text-sm mt-1 hidden">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­</p>
                </div>

                <div class="relative">
                    <input type="password" id="login-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full p-4 pl-10 rounded-2xl bg-white/5 border border-white/10 outline-none focus:border-cyan-500 transition-all">
                    <i data-lucide="eye" class="absolute top-1/2 left-3 -translate-y-1/2 cursor-pointer text-gray-400" onclick="togglePassword('login-pass')"></i>
                    <p id="login-pass-feedback" class="text-red-500 text-sm mt-1 hidden">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
                </div>

                <button type="submit" id="login-btn" class="w-full bg-cyan-500 text-black py-4 rounded-2xl font-black shadow-lg shadow-cyan-500/20">Ø¯Ø®ÙˆÙ„</button>
            </form>

            <p class="text-white text-center cursor-pointer text-sm font-bold hover:underline" onclick="showSection('register')">Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù†</p>
        </div>
    </section>

    <!-- Register Section -->
    <section id="register" class="tab-content hidden fixed inset-0 z-[10000] bg-slate-950 p-6 flex items-center justify-center">
        <div class="w-full max-w-sm space-y-6">
            <button onclick="showSection('home')" class="text-gray-500 flex items-center gap-2">
                <i data-lucide="arrow-right"></i> Ø±Ø¬ÙˆØ¹
            </button>
            <div class="text-center">
                <h2 class="text-3xl font-black">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
                <p class="text-gray-500 mt-2">ÙƒÙ† Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† ØªØ§Ø±ÙŠØ® Batch 11 IT</p>
            </div>
            <form id="register-form" class="space-y-4" onsubmit="handleRegister(event)">
                <div>
                    <input type="text" id="reg-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 outline-none focus:border-cyan-500 transition-all">
                    <p id="reg-name-feedback" class="text-red-500 text-sm mt-1 hidden">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</p>
                </div>

                <div>
                    <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 outline-none focus:border-cyan-500 transition-all">
                    <p id="reg-email-feedback" class="text-red-500 text-sm mt-1 hidden">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­</p>
                </div>

                <div class="relative">
                    <input type="password" id="reg-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full p-4 pl-10 rounded-2xl bg-white/5 border border-white/10 outline-none focus:border-cyan-500 transition-all">
                    <i data-lucide="eye" class="absolute top-1/2 left-3 -translate-y-1/2 cursor-pointer text-gray-400" onclick="togglePassword('reg-pass')"></i>
                    <p id="reg-pass-feedback" class="text-red-500 text-sm mt-1 hidden">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
                </div>

                <div>
                    <input type="password" id="reg-confirm-pass" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 outline-none focus:border-cyan-500 transition-all">
                    <p id="reg-confirm-pass-feedback" class="text-red-500 text-sm mt-1 hidden">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø©</p>
                </div>

                <button type="submit" id="reg-btn" class="w-full bg-white text-black py-4 rounded-2xl font-black">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
            </form>
        </div>
    </section>

</main>

    

    <!-- Full View Screens -->
    
    <!-- 1. Comments & Post Details View -->
    <div id="comments-view" class="full-view" onclick="this.style.display='none'">
        <div class="h-full flex flex-col glass-panel" onclick="event.stopPropagation()">
            <!-- Header -->
            <div class="p-4 border-b border-white/10 flex items-center gap-4">
                <button onclick="closeFullView('comments-view')"><i data-lucide="chevron-right"></i></button>
                <h3 class="font-bold">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
            </div>
            <!-- Image Preview (Small) -->
            <div id="comment-img-preview" class="w-full h-48 bg-black">
                <img src="" class="w-full h-full object-contain">
            </div>
            <!-- Comments List -->
            <div id="comments-list" class="flex-1 overflow-y-auto p-4 space-y-4 custom-scroll">
                <!-- Comments go here -->
            </div>
            <!-- Input Area -->
            <div class="p-4 bg-slate-900 border-t border-white/10 mb-[env(safe-area-inset-bottom)]">
                <div id="reply-label" class="hidden text-[10px] text-cyan-400 mb-1 flex justify-between">
                    <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰...</span>
                    <button onclick="cancelReply()" class="text-red-400">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
                <div class="flex gap-2">
                    <input type="text" id="comment-input" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹..." class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-cyan-500 text-sm">
                    <button onclick="sendComment()" class="w-12 h-12 bg-cyan-500 rounded-xl flex items-center justify-center text-black">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. Notifications View -->
    <div id="notifications-view" class="full-view" onclick="this.style.display='none'">
        <div class="h-full flex flex-col glass-panel" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-white/10 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <button onclick="closeFullView('notifications-view')"><i data-lucide="chevron-right"></i></button>
                    <h3 class="font-bold">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                </div>
                <button onclick="clearNotifications()" class="text-xs text-red-400 font-bold">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
            </div>
            <div id="notifications-list" class="flex-1 overflow-y-auto p-4 space-y-3">
                <!-- Notifications go here -->
            </div>
        </div>
    </div>

    <!-- 3. Reactors Modal (Improved) -->
    <div id="reactors-modal" class="fixed inset-0 z-[12000] hidden items-end justify-center bg-black/80 backdrop-blur-sm" onclick="toggleModal('reactors-modal', false)">
        <div class="glass-panel w-full max-w-md rounded-t-[2.5rem] p-6 space-y-4" onclick="event.stopPropagation()">
            <div class="w-12 h-1.5 bg-white/10 rounded-full mx-auto mb-2"></div>
            <div class="flex justify-between items-center">
                <h3 class="font-black text-xl">Ø§Ù„Ù…ØªÙØ§Ø¹Ù„ÙˆÙ†</h3>
                <button onclick="toggleModal('reactors-modal', false)" class="p-2"><i data-lucide="x"></i></button>
            </div>
            <div id="reactors-list" class="max-h-[60vh] overflow-y-auto space-y-4 custom-scroll pr-2">
                <!-- Reactors List -->
            </div>
        </div>
    </div>

    <!-- 4. Upload Modal -->
    <div id="upload-modal" class="fixed inset-0 z-[11000] hidden items-center justify-center bg-black/95 p-4" onclick="toggleModal('upload-modal', false)">
        <div class="glass-panel w-full max-w-lg rounded-[2.5rem] p-8 space-y-6" onclick="event.stopPropagation()">
            <div class="text-center">
                <h2 class="text-2xl font-black">Ø´Ø§Ø±ÙƒÙ†Ø§ Ø°ÙƒØ±Ù‰</h2>
                <p class="text-gray-500 text-sm mt-1">Ø§Ù„ØµÙˆØ± ØªØ¨Ù‚Ù‰ Ù„Ù„Ø£Ø¨Ø¯</p>
            </div>
            <div id="drop-zone" class="border-2 border-dashed border-white/10 rounded-[2rem] p-8 text-center bg-white/5 hover:border-cyan-500 transition-all cursor-pointer" onclick="document.getElementById('file-input').click()">
                <div id="upload-preview" class="hidden mb-4"><img src="" class="max-h-40 mx-auto rounded-xl"></div>
                <div id="upload-icon-box">
                    <i data-lucide="upload-cloud" class="w-12 h-12 mx-auto text-cyan-400 mb-2"></i>
                    <p class="text-sm font-bold text-gray-400">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ø¶ØºØ· Ù‡Ù†Ø§</p>
                </div>
                <input type="file" id="file-input" class="hidden" accept="image/*" onchange="previewUpload(this)">
            </div>
            <textarea id="file-caption" placeholder="Ù…Ø§ Ù‡ÙŠ Ù‚ØµØ© Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 min-h-[100px] outline-none focus:border-cyan-500"></textarea>
            <button onclick="handleFileUpload()" id="final-upload-btn" class="w-full bg-cyan-500 text-black py-4 rounded-2xl font-black shadow-xl shadow-cyan-500/20 flex items-center justify-center gap-2">
                Ù†Ø´Ø± Ø§Ù„Ø¢Ù† <div id="upload-loader" class="hidden w-5 h-5 border-2 border-black/20 border-t-black rounded-full animate-spin"></div>
            </button>
        </div>
    </div>

   <!-- Lightbox Ø§Ø­ØªØ±Ø§ÙÙŠ -->
<div id="lightbox"
     class="fixed inset-0 z-[20000] hidden flex-col justify-between
            backdrop-blur-2xl bg-black/90 transition-all duration-300"
     onclick="closeLightbox()">

    <!-- Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¶Ø¨Ø§Ø¨ Ù„Ù„ØµÙˆØ±Ø© -->
    <div id="lightbox-bg"
         class="absolute inset-0 bg-center bg-cover blur-3xl scale-110 opacity-40">
    </div>

    <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
    <div class="relative z-10 flex justify-between items-center p-6">
        <button class="p-3 bg-white/10 hover:bg-white/20 rounded-full transition">
            <i data-lucide="x"></i>
        </button>
        <!-- Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ØªÙ… Ø­Ø°ÙÙ‡ -->
    </div>

    <!-- Ø§Ù„ØµÙˆØ±Ø© -->
    <div class="relative z-10 flex-1 flex items-center justify-center px-6 pb-6">
        <img id="lightbox-img"
             src=""
             class="max-w-full max-h-[85vh] object-contain rounded-2xl
                    shadow-2xl transition-all duration-300">
    </div>

    <!-- Ø§Ù„ÙƒØ§Ø¨Ø´Ù† -->
    <div id="lightbox-caption-box"
         class="relative z-10 p-8 text-center
                bg-gradient-to-t from-black/80 via-black/40 to-transparent">
        <p id="lightbox-caption"
           class="font-bold text-xl tracking-wide">
        </p>
    </div>
</div>

<!-- Confirmation Dialog -->
<div id="confirm-modal" class="fixed inset-0 z-[25000] hidden items-center justify-center bg-black/90 backdrop-blur-md px-6">
    <div class="glass-panel w-full max-w-xs rounded-3xl p-8 text-center space-y-6">
        <h3 id="confirm-title" class="text-xl font-black"></h3>
        <p id="confirm-desc" class="text-gray-400 text-sm"></p>
        <div class="grid grid-cols-2 gap-4">
            <button onclick="toggleModal('confirm-modal', false)" class="py-3 bg-white/5 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
            <button id="confirm-yes-btn" class="py-3 bg-red-500 text-white rounded-xl font-black">ØªØ£ÙƒÙŠØ¯</button>
        </div>
    </div>
</div>

    <script>
        const SUPABASE_URL = 'https://tnfxguggaqskizlwwjmr.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_8rkweREppgkzZYznMPIJOQ_L1J_FMqg';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let currentImageId = null;
        let replyToId = null;
        let imagesData = [];

        // Initialization
        async function init() {
            lucide.createIcons();
            await checkUser();
            await fetchImages();
            setupRealtime();
        }

       async function checkUser() {
    const { data: { session } } = await supabaseClient.auth.getSession();

    if (!session) return; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø©

    const user = session.user;

    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø¬Ø¯ÙˆÙ„ profiles
    const { data: profile, error } = await supabaseClient
        .from('profiles')
        .select('id, is_banned')
        .eq('id', user.id)
        .single();

    if (!profile || profile.is_banned) {
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø£Ùˆ ØªÙ… Ø­Ø¸Ø±Ù‡ => ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        await supabaseClient.auth.signOut();
        currentUser = null;
        updateAuthUI();
        showToast("ØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø£Ùˆ ØªÙ… Ø­Ø¸Ø±ÙƒØŒ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§", "error");
        return;
    }

    // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙˆØµØ§Ù„Ø­
    currentUser = user;
    updateAuthUI();
    await checkNotifications();
}

        function updateAuthUI() {
    const authBtns = document.getElementById('auth-btns');
    const loggedInUser = document.getElementById('logged-in-user');
    const avatar = document.getElementById('user-avatar');
    const name = document.getElementById('welcome-name');
    const heroTitle = document.getElementById('hero-title');

    if (currentUser) {
        authBtns.classList.add('hidden');
        loggedInUser.classList.remove('hidden');
        const fullName = currentUser.user_metadata.full_name || 'Ø²Ù…ÙŠÙ„ÙŠ';
        avatar.innerText = fullName.charAt(0); // Ø£ÙˆÙ„ Ø­Ø±Ù Ù„Ù„Ø£ÙØ§ØªØ§Ø±
        name.innerText = fullName;            // Ø§Ù„Ø§Ø³Ù… ÙƒØ§Ù…Ù„ ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ±Ø­ÙŠØ¨
        heroTitle.innerHTML = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ <span class="text-cyan-400">${fullName}</span> âœ¨`; // Ø§Ù„Ø§Ø³Ù… ÙƒØ§Ù…Ù„ Ù‡Ù†Ø§ Ø£ÙŠØ¶Ù‹Ø§
    } else {
        authBtns.classList.remove('hidden');
        loggedInUser.classList.add('hidden');
        heroTitle.innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø¹Ø±Ø¶Ù†Ø§ âœ¨";
    }
}

        // Fetching Images
        async function fetchImages() {
            const { data, error } = await supabaseClient
                .from('images')
                .select(`*, reactions(*), comments(*)`)
                .order('created_at', { ascending: false });

            if (error) return showToast("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±", "error");
            imagesData = data;
            renderGallery();
        }

        function renderGallery() {
            const container = document.getElementById('gallery');
            if (!imagesData.length) {
                container.innerHTML = `<div class="col-span-full py-20 text-center text-gray-600 italic">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø°ÙƒØ±ÙŠØ§Øª Ø¨Ø¹Ø¯.. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø±!</div>`;
                return;
            }

            container.innerHTML = imagesData.map(img => {
                const myReact = img.reactions.find(r => r.user_id === currentUser?.id)?.reaction_type;
                const counts = {
                    like: img.reactions.filter(r => r.reaction_type === 'like').length,
                    heart: img.reactions.filter(r => r.reaction_type === 'heart').length,
                    haha: img.reactions.filter(r => r.reaction_type === 'haha').length
                };

                return `
                <div class="glass-card group overflow-hidden flex flex-col">
                    <!-- Image Body -->
                    <div class="aspect-square relative cursor-pointer overflow-hidden" onclick="openLightbox('${img.url}', '${img.caption || ''}')">
                        <img src="${img.url}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity p-4 flex flex-col justify-end">
                             <p class="text-[10px] text-white/80 line-clamp-2 font-medium">${img.caption || ''}</p>
                        </div>
                    </div>
                    
                    <!-- Info & Interactions -->
                    <div class="p-3 space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-[9px] font-black text-cyan-400 bg-cyan-500/10 px-2 py-1 rounded-md">
    ${img.publisher_name}
</span>
                            <span class="text-[8px] text-gray-500">${new Date(img.created_at).toLocaleDateString('ar-SA')}</span>
                        </div>

                        <!-- Reaction Bar -->
                        <div class="flex items-center gap-1">
                            <button onclick="toggleReaction('${img.id}', 'like')" class="react-btn ${myReact === 'like' ? 'active' : ''}" data-type="like">
                                <i data-lucide="thumbs-up" class="w-3.5 h-3.5"></i>
                                <span>${counts.like}</span>
                            </button>
                            <button onclick="toggleReaction('${img.id}', 'heart')" class="react-btn ${myReact === 'heart' ? 'active' : ''}" data-type="heart">
                                <i data-lucide="heart" class="w-3.5 h-3.5"></i>
                                <span>${counts.heart}</span>
                            </button>
                            <button onclick="toggleReaction('${img.id}', 'haha')" class="react-btn ${myReact === 'haha' ? 'active' : ''}" data-type="haha">
                                <span class="emoji text-xs">ğŸ˜‚</span>
                                <span>${counts.haha}</span>
                            </button>
                        </div>

                        <!-- Footer -->
                        <div class="flex items-center justify-between pt-2 border-t border-white/5">
                            <button onclick="openReactors('${img.id}')" class="text-[9px] text-gray-500 hover:text-cyan-400 transition-colors">
                                <b>${img.reactions.length}</b> Ù…ØªÙØ§Ø¹Ù„
                            </button>
                            <button onclick="openComments('${img.id}')" class="flex items-center gap-1 text-[10px] font-bold text-white bg-white/5 px-3 py-1.5 rounded-lg hover:bg-white/10">
                                <i data-lucide="message-circle" class="w-3.5 h-3.5"></i>
                                <span>${img.comments.length} ØªØ¹Ù„ÙŠÙ‚</span>
                            </button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        // Reactions Logic
        async function toggleReaction(imgId, type) {
            if (!currentUser) return showToast("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªÙØ§Ø¹Ù„", "error");

            const existing = imagesData.find(i => i.id === imgId).reactions.find(r => r.user_id === currentUser.id);

            if (existing) {
                if (existing.reaction_type === type) {
                    await supabaseClient.from('reactions').delete().eq('id', existing.id);
                } else {
                    await supabaseClient.from('reactions').update({ reaction_type: type }).eq('id', existing.id);
                }
            } else {
                await supabaseClient.from('reactions').insert({
                    image_id: imgId,
                    user_id: currentUser.id,
                    user_name: currentUser.user_metadata.full_name,
                    reaction_type: type
                });
            }
            fetchImages();
        }

        // Comments System
        async function openComments(imgId) {
            currentImageId = imgId;
            const img = imagesData.find(i => i.id === imgId);
            document.getElementById('comment-img-preview').querySelector('img').src = img.url;
            document.getElementById('comments-view').style.display = 'flex';
            loadComments(imgId);
        }

        async function loadComments(imgId) {
            const list = document.getElementById('comments-list');
            list.innerHTML = `<div class="flex justify-center py-10"><div class="w-8 h-8 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"></div></div>`;

            const { data: comments, error } = await supabaseClient
                .from('comments')
                .select('*')
                .eq('image_id', imgId)
                .order('created_at', { ascending: true });

            if (error) return;

            // Organize comments (Parents and Replies)
            const parentComments = comments.filter(c => !c.parent_id);
            const replies = comments.filter(c => c.parent_id);

            list.innerHTML = parentComments.map(c => {
                const childReplies = replies.filter(r => r.parent_id === c.id);
                return `
                <div class="space-y-3">
                    <!-- Main Comment -->
                    <div class="flex gap-3 items-start group">
                        <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-slate-700 to-slate-900 flex-shrink-0 flex items-center justify-center font-bold text-xs border border-white/5">
                            ${c.user_name?.charAt(0) || '?'}
                        </div>
                        <div class="flex-1 space-y-1">
                            <div class="bg-white/5 p-3 rounded-2xl rounded-tr-none relative border border-white/5">
                                <h4 class="text-xs font-black text-cyan-400 mb-1">${c.user_name}</h4>
                                <p class="text-sm text-gray-200 leading-relaxed">${c.content}</p>
                                ${currentUser?.id === c.user_id ? `<button onclick="deleteComment('${c.id}')" class="absolute top-2 left-2 text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><i data-lucide="trash-2" class="w-3 h-3"></i></button>` : ''}
                            </div>
                            <div class="flex gap-4 px-2">
                                <button onclick="setReply('${c.id}', '${c.user_name}')" class="text-[10px] font-bold text-gray-500 hover:text-white">Ø±Ø¯</button>
                                <span class="text-[10px] text-gray-600">${new Date(c.created_at).toLocaleTimeString('ar-SA', {hour:'2-digit', minute:'2-digit'})}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Replies -->
                    ${childReplies.map(r => `
                    <div class="flex gap-3 items-start mr-10 group">
                        <div class="w-7 h-7 rounded-lg bg-cyan-500/10 flex-shrink-0 flex items-center justify-center font-bold text-[10px] text-cyan-400 border border-cyan-500/20">
                            ${r.user_name?.charAt(0) || '?'}
                        </div>
                        <div class="flex-1 space-y-1">
                            <div class="bg-cyan-500/5 p-3 rounded-2xl rounded-tr-none border border-cyan-500/10">
                                <h4 class="text-[10px] font-black text-white/60 mb-0.5">${r.user_name}</h4>
                                <p class="text-xs text-gray-300">${r.content}</p>
                            </div>
                        </div>
                    </div>
                    `).join('')}
                </div>
                `;
            }).join('');
            
            if (parentComments.length === 0) {
                list.innerHTML = `<div class="text-center py-10 opacity-20"><i data-lucide="message-square-dashed" class="w-12 h-12 mx-auto mb-2"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª</p></div>`;
            }
            
            lucide.createIcons();
            list.scrollTop = list.scrollHeight;
        }

        function setReply(id, name) {
            replyToId = id;
            document.getElementById('reply-label').classList.remove('hidden');
            document.getElementById('reply-label').querySelector('span').innerText = `Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ ${name}`;
            document.getElementById('comment-input').focus();
        }

        function cancelReply() {
            replyToId = null;
            document.getElementById('reply-label').classList.add('hidden');
        }

        async function sendComment() {
            if (!currentUser) return showToast("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹", "error");
            const input = document.getElementById('comment-input');
            const content = input.value.trim();
            if (!content) return;

            const { data: newComment, error } = await supabaseClient.from('comments').insert({
                image_id: currentImageId,
                user_id: currentUser.id,
                user_name: currentUser.user_metadata.full_name,
                content: content,
                parent_id: replyToId
            }).select().single();

            if (error) return showToast("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚", "error");

            // Notification Logic
            if (replyToId) {
                const { data: parentComment } = await supabaseClient.from('comments').select('user_id').eq('id', replyToId).single();
                if (parentComment && parentComment.user_id !== currentUser.id) {
                    await supabaseClient.from('notifications').insert({
                        recipient_id: parentComment.user_id,
                        sender_name: currentUser.user_metadata.full_name,
                        type: 'reply',
                        image_id: currentImageId,
                        comment_id: newComment.id
                    });
                }
            }

            input.value = '';
            cancelReply();
            loadComments(currentImageId);
            fetchImages(); // Update counts in gallery
        }

        // Notifications
        async function checkNotifications() {
            const { data, error } = await supabaseClient
                .from('notifications')
                .select('*')
                .eq('recipient_id', currentUser.id)
                .eq('is_read', false);
            
            const dot = document.getElementById('notif-dot');
            if (data?.length > 0) dot.classList.remove('hidden');
            else dot.classList.add('hidden');
        }

        async function openNotifications() {
            if (!currentUser) return showToast("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª", "error");
            document.getElementById('notifications-view').style.display = 'flex';
            loadNotifications();
        }

        async function loadNotifications() {
            const list = document.getElementById('notifications-list');
            const { data, error } = await supabaseClient
                .from('notifications')
                .select('*')
                .eq('recipient_id', currentUser.id)
                .order('created_at', { ascending: false });

            if (data?.length === 0) {
                list.innerHTML = `<p class="text-center py-20 text-gray-600 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>`;
                return;
            }

            list.innerHTML = data.map(n => `
                <div onclick="goToNotif('${n.image_id}', '${n.id}')" class="p-4 rounded-2xl bg-white/5 border border-white/5 flex items-center gap-4 cursor-pointer hover:bg-white/10 ${!n.is_read ? 'border-r-4 border-r-cyan-500' : ''}">
                    <div class="w-10 h-10 rounded-full bg-cyan-500/10 flex items-center justify-center text-cyan-400 flex-shrink-0">
                        <i data-lucide="message-circle" class="w-5 h-5"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs"><b>${n.sender_name}</b> Ø±Ø¯ Ø¹Ù„Ù‰ ØªØ¹Ù„ÙŠÙ‚Ùƒ</p>
                        <span class="text-[10px] text-gray-500">${new Date(n.created_at).toLocaleTimeString('ar-SA')}</span>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        async function goToNotif(imgId, notifId) {
            await supabaseClient.from('notifications').update({ is_read: true }).eq('id', notifId);
            closeFullView('notifications-view');
            openComments(imgId);
            checkNotifications();
        }

        async function clearNotifications() {
            await supabaseClient.from('notifications').delete().eq('recipient_id', currentUser.id);
            loadNotifications();
            checkNotifications();
        }

        // Reactors Modal
        async function openReactors(imgId) {
            toggleModal('reactors-modal', true);
            const list = document.getElementById('reactors-list');
            list.innerHTML = `<div class="flex justify-center py-10"><div class="loader"></div></div>`;
            
            const { data: reacts } = await supabaseClient.from('reactions').select('*').eq('image_id', imgId);
            
            const icons = { like: 'ğŸ‘', heart: 'â¤ï¸', haha: 'ğŸ˜‚' };
            
            list.innerHTML = reacts.map(r => `
                <div class="flex items-center justify-between bg-white/5 p-4 rounded-2xl">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center font-black">${r.user_name.charAt(0)}</div>
                        <div>
                            <p class="text-sm font-bold">${r.user_name}</p>
                            <p class="text-[10px] text-gray-500">Ù…ØªÙØ§Ø¹Ù„</p>
                        </div>
                    </div>
                    <span class="text-xl">${icons[r.reaction_type]}</span>
                </div>
            `).join('') || '<p class="text-center text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªÙØ§Ø¹Ù„ÙˆÙ†</p>';
        }

       // Utilities
function showSection(id) {
    document.querySelectorAll('.tab-content').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    if (id === 'home') document.getElementById('hero-section').classList.remove('hidden');
    else document.getElementById('hero-section').classList.add('hidden');
}

function toggleModal(id, show) {
    const m = document.getElementById(id);
    if (show) { m.classList.remove('hidden'); m.classList.add('flex'); }
    else { m.classList.add('hidden'); m.classList.remove('flex'); }
}

function closeFullView(id) {
    document.getElementById(id).style.display = 'none';
}

function showToast(msg, type = "success") {
    const container = document.getElementById('toast-container');
    const t = document.createElement('div');
    t.className = `glass-panel px-6 py-4 rounded-2xl border-r-4 ${type === 'success' ? 'border-cyan-500 text-cyan-400' : 'border-red-500 text-red-400'} font-bold shadow-2xl mb-3 flex items-center gap-3 animate-slide-in`;
    t.innerHTML = `<i data-lucide="${type === 'success' ? 'check-circle' : 'alert-circle'}" class="w-5 h-5"></i> <span>${msg}</span>`;
    container.appendChild(t);
    lucide.createIcons();
    setTimeout(() => {
        t.style.opacity = '0';
        t.style.transform = 'translateY(-20px)';
        setTimeout(() => t.remove(), 500);
    }, 3000);
}

// Upload Preview
function previewUpload(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
            document.getElementById('upload-preview').classList.remove('hidden');
            document.getElementById('upload-preview').querySelector('img').src = e.target.result;
            document.getElementById('upload-icon-box').classList.add('hidden');
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Toggle visibility of both password fields using the first field's eye icon
function toggleBothPasswords() {
    const newPass = document.getElementById("new-password");
    const confirmPass = document.getElementById("confirm-password");
    const icon = newPass.parentNode.querySelector("i");

    const isHidden = newPass.type === "password";

    newPass.type = isHidden ? "text" : "password";
    confirmPass.type = isHidden ? "text" : "password";

    icon.setAttribute("data-lucide", isHidden ? "eye-off" : "eye");

    if (window.lucide) lucide.replace();
}

// Password Update Handler
async function handlePasswordUpdate() {
    const newPass = document.getElementById('new-password').value;
    const confirmPass = document.getElementById('confirm-password').value;
    const btn = document.getElementById('update-pass-btn');

    if (!newPass || !confirmPass) return showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");
    if (newPass.length < 6) return showToast("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error");
    if (newPass !== confirmPass) return showToast("ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©", "error");

    btn.disabled = true;
    btn.innerHTML = '<div class="w-5 h-5 border-2 border-black/20 border-t-black rounded-full animate-spin"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';

    const { error } = await supabaseClient.auth.updateUser({ password: newPass });

    if (error) {
        showToast("ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + error.message, "error");
    } else {
        showToast("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­ âœ…", "success");
        document.getElementById('new-password').value = '';
        document.getElementById('confirm-password').value = '';
        // Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø¹Ù†Ø¯Ùƒ Ø¯Ø§Ù„Ø© Ù„Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        // switchMtrView('mtr-main-menu');
    }

    btn.disabled = false;
    btn.innerHTML = 'ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
}
        async function handleFileUpload() {
            const fileInput = document.getElementById('file-input');
            const caption = document.getElementById('file-caption').value;
            const btn = document.getElementById('final-upload-btn');
            const loader = document.getElementById('upload-loader');

            if (!fileInput.files[0]) return showToast("Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹", "error");

            btn.disabled = true;
            loader.classList.remove('hidden');

            try {
                const file = fileInput.files[0];
                const fileName = `${Date.now()}_${file.name}`;
                
                const { error: storageError } = await supabaseClient.storage
                    .from('images')
                    .upload(`public/${fileName}`, file);

                if (storageError) throw storageError;

                const { data: { publicUrl } } = supabaseClient.storage
                    .from('images')
                    .getPublicUrl(`public/${fileName}`);

                await supabaseClient.from('images').insert({
                    url: publicUrl,
                    caption: caption,
                    publisher_id: currentUser.id,
                    publisher_name: currentUser.user_metadata.full_name
                });

              showToast(`
<div class="flex items-center justify-end gap-2">
    <span>ØªÙ… Ù†Ø´Ø± Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­!</span>
    <i data-lucide="badge-check" class="w-5 h-5 text-green-400"></i>
</div>
`);
                setTimeout(() => location.reload(), 1500);

            } catch (err) {
                showToast("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹", "error");
                btn.disabled = false;
                loader.classList.add('hidden');
            }
        }

        // Lightbox
        function openLightbox(src, caption) {
            const lb = document.getElementById('lightbox');
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox-caption').innerText = caption;
            lb.classList.remove('hidden');
            lb.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function handleUploadClick() {
            if (!currentUser) {
                showSection('login');
                showToast("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø±ÙØ¹", "error");
            } else {
                toggleModal('upload-modal', true);
            }
        }

        function confirmAction(title, desc, action) {
            document.getElementById('confirm-title').innerText = title;
            document.getElementById('confirm-desc').innerText = desc;
            toggleModal('confirm-modal', true);
            document.getElementById('confirm-yes-btn').onclick = async () => {
                if (action === 'logout') {
                    await supabaseClient.auth.signOut();
                    location.reload();
                }
            };
        }
// Splash Screen Logic
window.addEventListener('load', () => {
    const splash = document.getElementById('splash-screen');

    setTimeout(() => {
        splash.classList.add('hidden');
    }, 3000); // 3 Ø«ÙˆØ§Ù†ÙŠ
});
        // Realtime Subscriptions
    function setupRealtime() {
        supabaseClient
            .channel('schema-db-changes')
            .on('postgres_changes', { event: '*', schema: 'public', table: 'images' }, fetchImages)
            .on('postgres_changes', { event: '*', schema: 'public', table: 'reactions' }, fetchImages)
            .on('postgres_changes', { event: '*', schema: 'public', table: 'comments' }, fetchImages)
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'notifications' }, checkNotifications)
            .subscribe();
    }

    // Login Handler with validation
    async function handleLogin(e) {
        e.preventDefault();

        const email = document.getElementById('login-email');
        const pass = document.getElementById('login-pass');
        const emailFeedback = document.getElementById('login-email-feedback');
        const passFeedback = document.getElementById('login-pass-feedback');

        let valid = true;
        emailFeedback.classList.add('hidden');
        passFeedback.classList.add('hidden');

        if (!email.value) {
            emailFeedback.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ";
            emailFeedback.classList.remove('hidden');
            valid = false;
        }

        if (!pass.value) {
            passFeedback.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±";
            passFeedback.classList.remove('hidden');
            valid = false;
        }

        if (!valid) return;

        const btn = document.getElementById('login-btn');
        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";

        const { error } = await supabaseClient.auth.signInWithPassword({ email: email.value, password: pass.value });
        if (error) {
            showToast("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©", "error");
            btn.disabled = false;
            btn.innerText = "Ø¯Ø®ÙˆÙ„";
        } else {
            location.reload();
        }
    }

    // Register Handler with validation
    async function handleRegister(e) {
        e.preventDefault();

        const name = document.getElementById('reg-name');
        const email = document.getElementById('reg-email');
        const pass = document.getElementById('reg-pass');
        const confirm = document.getElementById('reg-confirm-pass');

        const nameFeedback = document.getElementById('reg-name-feedback');
        const emailFeedback = document.getElementById('reg-email-feedback');
        const passFeedback = document.getElementById('reg-pass-feedback');
        const confirmFeedback = document.getElementById('reg-confirm-pass-feedback');

        [nameFeedback, emailFeedback, passFeedback, confirmFeedback].forEach(f => f.classList.add('hidden'));

        let valid = true;

        if (!name.value) { nameFeedback.textContent="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"; nameFeedback.classList.remove('hidden'); valid=false; }
        if (!email.value) { emailFeedback.textContent="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"; emailFeedback.classList.remove('hidden'); valid=false; }
        if (!pass.value) { passFeedback.textContent="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"; passFeedback.classList.remove('hidden'); valid=false; }
        if (!confirm.value) { confirmFeedback.textContent="ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"; confirmFeedback.classList.remove('hidden'); valid=false; }
        if (pass.value && confirm.value && pass.value !== confirm.value) { confirmFeedback.textContent="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø©"; confirmFeedback.classList.remove('hidden'); valid=false; }

        if (!valid) return;

        const { error } = await supabaseClient.auth.signUp({
            email: email.value,
            password: pass.value,
            options: { data: { full_name: name.value } }
        });

        if (error) showToast(error.message, "error");
        else {
            showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨! Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ø¢Ù†");
            showSection('login');
        }
    }

    // Toggle password visibility (works on first password field only)
    function togglePassword(fieldId) {
        const mainInput = document.getElementById(fieldId);
        let confirmInput = null;

        if (fieldId === "reg-pass") {
            confirmInput = document.getElementById("reg-confirm-pass");
        }

        const isHidden = mainInput.type === "password";

        mainInput.type = isHidden ? "text" : "password";
        if (confirmInput) confirmInput.type = isHidden ? "text" : "password";

        const icon = mainInput.parentNode.querySelector("i");
        icon.setAttribute("data-lucide", isHidden ? "eye-off" : "eye");

        if (window.lucide) lucide.replace();
    }

    // Initial Run
    init();

    // Close UI on outside click
    window.addEventListener('click', (e) => {
        if (e.target.id === 'comments-view') closeFullView('comments-view');
        if (e.target.id === 'notifications-view') closeFullView('notifications-view');
    });

    // Set lightbox background
    document.getElementById("lightbox-bg").style.backgroundImage = `url(${imageUrl})`;
</script>
</body>
</html>
